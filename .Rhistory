TIMELY_CARE_TBV +
TRAINING_BBV +
TRAINING_MBV +
TRAINING_TBV +
distinctBens +
epStayCt +
medStanPayPerBen + (1|State),
data=df[sample(nrow(df), 1000),],
REML=T)
summary(m1)
m1 <- lmer(neg_rec ~ Ownership.Type +
days_operation +
Average_Daily_Census +
percRuralZipBen +
aveAge +
percMale +
aveHomeHealth7dp +
percSOSDhome +
percSOSDassisLiv +
percSOSlongtermcare +
percSOSskilledNurse +
percSOSinpatient +
percSOSinpatientHospice +
EMO_REL_BBV +
EMO_REL_TBV +
RESPECT_BBV +
RESPECT_MBV +
RESPECT_TBV +
SYMPTOMS_BBV +
SYMPTOMS_MBV +
SYMPTOMS_TBV +
TEAM_COMM_BBV +
TEAM_COMM_MBV +
TEAM_COMM_TBV +
TIMELY_CARE_BBV +
TIMELY_CARE_MBV +
TIMELY_CARE_TBV +
TRAINING_BBV +
TRAINING_MBV +
TRAINING_TBV +
distinctBens +
epStayCt +
medStanPayPerBen + (1|State),
data=df[sample(nrow(df), 1000),],
REML=T)
summary(m1)
dim(df)
m1 <- lmer(neg_rec ~ Ownership.Type +
days_operation +
Average_Daily_Census +
percRuralZipBen +
aveAge +
percMale +
aveHomeHealth7dp +
percSOSDhome +
percSOSDassisLiv +
percSOSlongtermcare +
percSOSskilledNurse +
percSOSinpatient +
percSOSinpatientHospice +
EMO_REL_BBV +
EMO_REL_TBV +
RESPECT_BBV +
RESPECT_MBV +
RESPECT_TBV +
SYMPTOMS_BBV +
SYMPTOMS_MBV +
SYMPTOMS_TBV +
TEAM_COMM_BBV +
TEAM_COMM_MBV +
TEAM_COMM_TBV +
TIMELY_CARE_BBV +
TIMELY_CARE_MBV +
TIMELY_CARE_TBV +
TRAINING_BBV +
TRAINING_MBV +
TRAINING_TBV +
distinctBens +
epStayCt +
medStanPayPerBen + (1|State),
data=df[sample(nrow(df), 1630),],
REML=T)
summary(m1)
m1 <- lmer(neg_rec ~ Ownership.Type +
days_operation +
Average_Daily_Census +
percRuralZipBen +
aveAge +
percMale +
aveHomeHealth7dp +
percSOSDhome +
percSOSDassisLiv +
percSOSlongtermcare +
percSOSskilledNurse +
percSOSinpatient +
percSOSinpatientHospice +
EMO_REL_BBV +
EMO_REL_TBV +
RESPECT_BBV +
RESPECT_MBV +
RESPECT_TBV +
SYMPTOMS_BBV +
SYMPTOMS_MBV +
SYMPTOMS_TBV +
TEAM_COMM_BBV +
TEAM_COMM_MBV +
TEAM_COMM_TBV +
TIMELY_CARE_BBV +
TIMELY_CARE_MBV +
TIMELY_CARE_TBV +
TRAINING_BBV +
TRAINING_MBV +
TRAINING_TBV +
distinctBens +
epStayCt +
medStanPayPerBen + (1|State),
data=df[sample(nrow(df), 1630),],
REML=T)
summary(m1)
m1 <- lmer(neg_rec ~ Ownership.Type +
days_operation +
Average_Daily_Census +
percRuralZipBen +
aveAge +
percMale +
aveHomeHealth7dp +
percSOSDhome +
percSOSDassisLiv +
percSOSlongtermcare +
percSOSskilledNurse +
percSOSinpatient +
percSOSinpatientHospice +
EMO_REL_BBV +
EMO_REL_TBV +
RESPECT_BBV +
RESPECT_MBV +
RESPECT_TBV +
SYMPTOMS_BBV +
SYMPTOMS_MBV +
SYMPTOMS_TBV +
TEAM_COMM_BBV +
TEAM_COMM_MBV +
TEAM_COMM_TBV +
TIMELY_CARE_BBV +
TIMELY_CARE_MBV +
TIMELY_CARE_TBV +
TRAINING_BBV +
TRAINING_MBV +
TRAINING_TBV +
distinctBens +
epStayCt +
medStanPayPerBen + (1|State),
data=df[sample(nrow(df), 1630),],
REML=T)
summary(m1)
m1 <- lmer(neg_rec ~ Ownership.Type +
days_operation +
Average_Daily_Census +
percRuralZipBen +
aveHomeHealth7dp +
percSOSinpatientHospice +
EMO_REL_BBV +
RESPECT_BBV +
RESPECT_TBV +
SYMPTOMS_BBV +
TEAM_COMM_BBV +
TEAM_COMM_MBV +
TEAM_COMM_TBV +
TIMELY_CARE_BBV +
TIMELY_CARE_TBV +
TRAINING_BBV +
distinctBens +
epStayCt +
medStanPayPerBen + (1|State),
data=df[sample(nrow(df), 1630),],
REML=T)
summary(m1)
m1 <- lmer(neg_rec ~ Ownership.Type +
percRuralZipBen +
aveHomeHealth7dp +
percSOSinpatientHospice +
EMO_REL_BBV +
RESPECT_BBV +
RESPECT_TBV +
SYMPTOMS_BBV +
TEAM_COMM_BBV +
TEAM_COMM_MBV +
TEAM_COMM_TBV +
TIMELY_CARE_BBV +
TIMELY_CARE_TBV +
TRAINING_BBV +
distinctBens +
epStayCt +
medStanPayPerBen + (1|State),
data=df[sample(nrow(df), 1630),],
REML=T)
summary(m1)
m1 <- lmer(neg_rec ~ Ownership.Type +
percRuralZipBen +
aveHomeHealth7dp +
percSOSinpatientHospice +
EMO_REL_BBV +
RESPECT_BBV +
RESPECT_TBV +
SYMPTOMS_BBV +
TEAM_COMM_BBV +
TEAM_COMM_MBV +
TEAM_COMM_TBV +
TIMELY_CARE_BBV +
TIMELY_CARE_TBV +
TRAINING_BBV +
distinctBens +
epStayCt
+ (1|State),
data=df[sample(nrow(df), 1630),],
REML=T)
summary(m1)
m1 <- lmer(neg_rec ~ Ownership.Type +
percRuralZipBen +
aveHomeHealth7dp +
percSOSinpatientHospice +
EMO_REL_BBV +
RESPECT_BBV +
RESPECT_TBV +
SYMPTOMS_BBV +
TEAM_COMM_BBV +
TEAM_COMM_MBV +
TEAM_COMM_TBV +
TIMELY_CARE_BBV +
TIMELY_CARE_TBV +
TRAINING_BBV +
distinctBens
+ (1|State),
data=df[sample(nrow(df), 1630),],
REML=T)
summary(m1)
m1 <- lmer(neg_rec ~ Ownership.Type +
percRuralZipBen +
percSOSinpatientHospice +
EMO_REL_BBV +
RESPECT_BBV +
RESPECT_TBV +
SYMPTOMS_BBV +
TEAM_COMM_BBV +
TEAM_COMM_MBV +
TEAM_COMM_TBV +
TIMELY_CARE_BBV +
TIMELY_CARE_TBV +
TRAINING_BBV +
distinctBens
+ (1|State),
data=df[sample(nrow(df), 1630),],
REML=T)
summary(m1)
mean(kfold_results$train$mae)
mean(kfold_results$test$mae)
kfold_results = lmer_kfold(df, summary(m1)$call, 10)
mean(kfold_results$train$mae)
mean(kfold_results$test$mae)
m1 <- lmer(neg_rec ~ Ownership.Type +
percRuralZipBen +
percSOSinpatientHospice +
EMO_REL_BBV +
RESPECT_BBV +
RESPECT_TBV +
SYMPTOMS_BBV +
TEAM_COMM_BBV +
TEAM_COMM_MBV +
TEAM_COMM_TBV +
TIMELY_CARE_BBV +
TIMELY_CARE_TBV +
TRAINING_BBV +
distinctBens
+ (1|State),
data=df[sample(nrow(df), 1630),],
REML=T)
summary(m1)
m1 <- lmer(neg_rec ~ Ownership.Type +
percRuralZipBen +
percSOSinpatientHospice +
EMO_REL_BBV +
RESPECT_BBV +
RESPECT_TBV +
SYMPTOMS_BBV +
TEAM_COMM_BBV +
TEAM_COMM_MBV +
TEAM_COMM_TBV +
TIMELY_CARE_BBV +
TIMELY_CARE_TBV +
TRAINING_BBV +
distinctBens +
medStanPayPerBen
+ (1|State),
data=df[sample(nrow(df), 1630),],
REML=T)
summary(m1)
m1 <- lmer(neg_rec ~ Ownership.Type +
percRuralZipBen +
percSOSinpatientHospice +
EMO_REL_BBV +
RESPECT_BBV +
RESPECT_TBV +
SYMPTOMS_BBV +
TEAM_COMM_BBV +
TEAM_COMM_MBV +
TEAM_COMM_TBV +
TIMELY_CARE_BBV +
TIMELY_CARE_TBV +
TRAINING_BBV +
distinctBens +
aveHomeHealth7dp
+ (1|State),
data=df[sample(nrow(df), 1630),],
REML=T)
summary(m1)
m1 <- lmer(neg_rec ~ Ownership.Type +
percRuralZipBen +
percSOSinpatientHospice +
EMO_REL_BBV +
RESPECT_BBV +
RESPECT_TBV +
SYMPTOMS_BBV +
TEAM_COMM_BBV +
TEAM_COMM_MBV +
TEAM_COMM_TBV +
TIMELY_CARE_BBV +
TIMELY_CARE_TBV +
TRAINING_BBV +
distinctBens
+ (1|State),
data=df[sample(nrow(df), 1630),],
REML=T)
summary(m1)
m1 <- lmer(neg_rec ~ Ownership.Type +
percRuralZipBen +
percSOSinpatientHospice +
EMO_REL_BBV +
RESPECT_BBV +
RESPECT_TBV +
SYMPTOMS_BBV +
TEAM_COMM_BBV +
TEAM_COMM_MBV +
TEAM_COMM_TBV +
TIMELY_CARE_BBV +
TIMELY_CARE_TBV +
TRAINING_BBV +
distinctBens
+ (1|State),
data=df[sample(nrow(df), 1630),],
REML=T)
summary(m1)
saveRDS(m1, 'data/interim/mvp_model.rds')
?fixef
fixef(m0)
fixef(m1)
fixef(m1)[0]
list(fixef(m1))
data.frame(fixef(m1))
fixef(m1)
ranef(m1)
ndata = list(Ownership.Type='Non-Profit',
percRuralZipBen=1,
percSOSinpatientHospice=2,
EMO_REL_BBV=1,
RESPECT_BBV=2,
RESPECT_TBV=1,
SYMPTOMS_BBV=1,
TEAM_COMM_BBV=1,
TEAM_COMM_MBV=1,
TEAM_COMM_TBV=1,
TIMELY_CARE_BBV =2,
TIMELY_CARE_TBV =2,
TRAINING_BBV =1,
distinctBens =.5,
State='MN'
)
predict(m1, ndata)
predict(m1, ndata)
predict(m1, df)
ndata = data.frame(Ownership.Type='Non-Profit',
percRuralZipBen=1,
percSOSinpatientHospice=2,
EMO_REL_BBV=1,
RESPECT_BBV=2,
RESPECT_TBV=1,
SYMPTOMS_BBV=1,
TEAM_COMM_BBV=1,
TEAM_COMM_MBV=1,
TEAM_COMM_TBV=1,
TIMELY_CARE_BBV =2,
TIMELY_CARE_TBV =2,
TRAINING_BBV =1,
distinctBens =.5,
State='MN'
)
predict(m1, ndata)
fixef(m1)
ranef(m1)
matrix(c(1,2,3))
matrix(c(4,5,6))
matrix(c(1,2,3)) %*% matrix(c(4,5,6))
?matrix
matrix(c(1,2,3)) %*% matrix(c(4,5,6),ncol=1)
matrix(c(1,2,3)) %*% matrix(c(4,5,6),nrow=1)
matrix(c(4,5,6),nrow=1) %*% matrix(c(1,2,3))
fixef(m1)
data.frame(fixef(m1))
data.frame(ranef(m1))
ranef(m1)
write.csv(ranef(m1), 'data/interim/fixef.csv')
write.csv(ranef(m1), 'data/interim/ranef.csv')
write.csv(fixef(m1), 'data/interim/fixef.csv')
df
predict(m1, df)
data.frame(predict(m1, df))
head(df)
data.frame(ccn = df$ccn, pred=predict(m1, df))
write.csv(data.frame(ccn = df$ccn, pred=predict(m1, df)),
'data/interim/preds.csv')
m1 <- lmer(neg_rec ~ percRuralZipBen +
percSOSinpatientHospice +
EMO_REL_BBV +
RESPECT_BBV +
RESPECT_TBV +
SYMPTOMS_BBV +
TEAM_COMM_BBV +
TEAM_COMM_MBV +
TEAM_COMM_TBV +
TIMELY_CARE_BBV +
TIMELY_CARE_TBV +
TRAINING_BBV +
distinctBens
+ (1|State),
data=df[sample(nrow(df), 1630),],
REML=T)
summary(m1)
mean(kfold_results$train$mae)
mean(kfold_results$test$mae)
mean(kfold_results$train$rmse)
mean(kfold_results$test$rmse)
plot(m1)
summary(m1)
summary(rslopes)
summary(lmer_imp_features)
# libraries
library(lme4)
library(lmerTest)
library(tidyverse)
library(car)
library(Metrics)
f_K_fold <- function(Nobs,K=5){
rs <- runif(Nobs)
id <- seq(Nobs)[order(rs)]
k <- as.integer(Nobs*seq(1,K-1)/K)
k <- matrix(c(0,rep(k,each=2),Nobs),ncol=2,byrow=TRUE)
k[,1] <- k[,1]+1
l <- lapply(seq.int(K),function(x,k,d)
list(train=d[!(seq(d) %in% seq(k[x,1],k[x,2]))],
test=d[seq(k[x,1],k[x,2])]),k=k,d=id)
return(l)
}
lmer_kfold = function(df, call, n_folds){
rmse_test_out = c()
mse_test_out = c()
mae_test_out = c()
rmse_train_out = c()
mse_train_out = c()
mae_train_out = c()
folds = f_K_fold(dim(df)[1], n_folds)
for(fold in folds){
m = lmer(call,
df[fold$train,],
REML=F)
preds = predict(m, newdata=df[fold$test,])
train_preds = predict(m, newdata=df[fold$train,])
rmse_test_out = append(rmse_test_out,
rmse(df$RECOMMEND_BBV[fold$test], preds))
mse_test_out = append(mse_test_out,
mse(df$RECOMMEND_BBV[fold$test], preds))
mae_test_out = append(mae_test_out,
mae(df$RECOMMEND_BBV[fold$test], preds))
rmse_train_out = append(rmse_train_out,
rmse(df$RECOMMEND_BBV[fold$train], train_preds))
mse_train_out = append(mse_train_out,
mse(df$RECOMMEND_BBV[fold$train], train_preds))
mae_train_out = append(mae_train_out,
mae(df$RECOMMEND_BBV[fold$train], train_preds))
}
list(train=list(rmse=rmse_test_out, mse=mse_test_out, mae=mae_test_out),
test=list(rmse=rmse_train_out, mse=mse_train_out, mae=mae_train_out))
}
# read in data
df_train = read.csv('data/processed/to_R_train.csv')
df_val = read.csv('data/processed/to_R_val.csv')
df_full_train = read.csv('data/processed/to_R.csv')
dim(df_train)
dim(df_val)
lm_perceptions = lm(RECOMMEND_BBV ~
H_002_01_OBSERVED +
EMO_REL_BTR +
RESPECT_BTR +
SYMPTOMS_BTR +
TEAM_COMM_BTR +
TIMELY_CARE_BTR +
TRAINING_BTR,
data=df_train)
summary(lm_perceptions)
meadn(df_train$RECOMMEND_BBV)
mean(df_train$RECOMMEND_BBV)
mode(df_train$RECOMMEND_BBV)
median(df_train$RECOMMEND_BBV)
df_train$RECOMMEND_BBV
